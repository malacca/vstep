define(["module","vue.utils","curd-utils"],function(e,t,i){"use strict";var a=e.uri.split("/"),r=(a=a.slice(0,a.length-2).join("/")+"/",{name:"draggableIf",functional:!0,render:function(e,t){return t.props.enable?e("draggable",t.data,t.children):t.children}}),o=(0,t.n)({},void 0,r,void 0,void 0,void 0,!1,void 0,void 0,void 0),n={name:"CurdChoose",inject:{elForm:{default:""},elFormItem:{default:""}},props:{name:String,id:String,size:String,placeholder:String,disabled:Boolean,clearable:Boolean,allowInput:Boolean,multiple:Boolean,multipleLimit:{type:Number,default:0},value:{required:!0},selectIcon:{type:String,default:"el-icon-more"},staticIcon:Boolean,remoteUrl:{type:String,required:!0},credentials:{type:Boolean,default:!1},pageSize:{type:Number,default:100},itemType:Number,showPlus:Boolean},data:function(){return{inputLoaded:!1,inputValue:"",selected:this.multiple?[]:{},adding:!1,dialogQ:"",dialogVisible:!1,dialogLoading:!0,dialogError:null,dataPage:1,dataTotal:0,dataOptions:[],hasMore:!1}},mounted:function(){var e=this;this.$nextTick(function(){e.inputLoaded=!0})},computed:{_elFormItemSize:function(){return(this.elFormItem||{}).elFormItemSize},autoSize:function(){return this.size||this._elFormItemSize||(this.$ELEMENT||{}).size},autoDisabled:function(){return this.disabled||(this.elForm||{}).disabled},inputPlaceholder:function(){return this.multiple&&this.selected.length?"":this.placeholder},firstSelected:function(){if(this.multiple&&this.selected.length){var e=this.selected[0];return e.label||e.value}return null},countSelected:function(){return this.multiple&&this.selected.length?this.selected.length-1:0},options:function(){var e=this,t=[];return(this.dataOptions||[]).forEach(function(i){var a=e._formatItem(i);a&&(!e.hasMore&&e.dialogQ&&-1===a.value.indexOf(e.dialogQ)&&-1===a.label.indexOf(e.dialogQ)||t.push(a))}),t},showClear:function(){return this.clearable&&!this.disabled&&this.inputLoaded&&(this.multiple?this.selected.length:this.selected&&this.selected.value)&&this.$refs.inlineInput&&(this.$refs.inlineInput.focused||this.$refs.inlineInput.hovering)}},watch:{value:{immediate:!0,handler:function(){this.__triggerValue?this.__triggerValue=!1:this._passiveChange()}},inputValue:function(e){if(this.allowInput)if(this.multiple)this.multipleLimit&&this.selected.length>=this.multipleLimit&&(this.inputValue="");else{var t=this.selected;(t?t.label:null)!==e&&(this.selected=this._formatItem(e),this._triggerChange())}},multiple:function(e){if(e){this.inputValue="";var t=[];this.selected&&this.selected.value&&t.push(this.selected),this.selected=t}else{var i=this.selected.length?this.selected[0]:null;i&&(this.inputValue=i.label),this.selected=i||{},this._updateInputPadding()}this._triggerChange()},allowInput:function(){this._updateInputPadding()},remoteUrl:function(){this.dialogError=null},credentials:function(){this.dialogError=null}},methods:{_passiveChange:function(){var e,t,i=this,a=this.value;this.multiple?(e=[],t="",(Array.isArray(a)?a.slice():[]).forEach(function(t){(t=i._formatItem(t))&&e.push(t)})):t=(e=this._formatItem(a))?e.label:"";this.selected=e,t!==this.inputValue&&(this.inputValue=t),this._triggerChange()},_triggerChange:function(){var e,t=this;this.multiple&&this.allowInput&&this.$nextTick(function(){t._updateInputPadding()}),e=1===this.itemType?this.selected:this.multiple?this.selected.map(function(e){return e.label}):this.selected?this.selected.label:null,this.__triggerValue=!0,this.$emit("input",e),this.$emit("change",e)},_updateInputPadding:function(){var e,t="";this.multiple&&(this.$refs.inlineTags.childNodes.forEach(function(t){1===t.nodeType&&(e=t)}),e&&(t=e.offsetWidth+e.offsetLeft+6+"px"));this.$refs.inlineInput.$refs.input.style.paddingLeft=t},_clear:function(){this.inputValue="",this.selected=this.multiple?[]:{},this._triggerChange()},_addInputMult:function(){if(this.multiple&&this.allowInput&&this.inputValue){var e=this.inputValue;this.inputValue="",this._select({value:e,label:e})}},_formatItem:function(e){if("string"==typeof e)return{value:e,label:e};var t=e||{},i=t.value,a=t.label;return i?{value:i,label:a||i}:null},_select:function(e){var t;this.multiple?this.multipleLimit&&!(this.multipleLimit>this.selected.length)||this.selected.find(function(t){return t.value===e.value})||(t=!0,this.selected.push(e)):(t=!0,this.selected=Object.assign({},e),this.inputValue=e.label,this.dialogVisible=!1),t&&this._triggerChange()},_sortSelected:function(){this._triggerChange()},_removeTag:function(e){this.selected.splice(e,1),this._triggerChange()},choose:function(){this.autoDisabled||(this.dialogVisible=!0,this.staticIcon?this._getCurrentIcons():!1!==this.dialogError&&this._fetchData(1))},_getCurrentIcons:function(){var e=i.getAllIcons();this.dataTotal=e.length,this.dataOptions=e,this.hasMore=!1,this.dialogError=!1,this.dialogLoading=!1},search:function(){this.hasMore&&this._fetchData(1)},fresh:function(){this._fetchData(this.dataPage)},toPage:function(e){this._fetchData(e)},_fetchData:function(e){var t=this;if(!this.remoteUrl)return this.dialogLoading=!1,void(this.dialogError="未指定 remote url");var i={handleError:!1,credentials:this.credentials?"cors":"omit"},a=this.remoteUrl+(this.remoteUrl.indexOf("?")>-1?"&":"?")+"q="+this.dialogQ+"&pagesize="+this.pageSize+"&page="+e;return this.dataPage=e,this.dialogLoading=!0,this.$admin.fetchJson(a,i).then(function(i){Array.isArray(i)?(t.dataTotal=i.length,t.dataOptions=i):(i=i||{},t.dataOptions=i.options||[],t.dataTotal=i.total||t.dataOptions.length),t.hasMore=!(!t.dialogQ&&1===e&&t.dataTotal<=t.dataOptions.length),t.dialogError=!1,t.dialogLoading=!1}).catch(function(e){t.dialogLoading=!1,t.dialogError="["+e.code+"]"+e.message})},_chooseClosed:function(){this.dialogError&&(this.dialogError=null)},addNew:function(){var e=this;if(this.dialogQ)return this.adding=!0,this.$admin.postJson(this.remoteUrl,{label:this.dialogQ}).then(function(t){e.adding=!1;var i=t||{},a=i.label,r=i.value;if(r){e.dialogQ="";var o={value:r,label:a};e._select(o),e.multiple&&e.dataOptions.unshift(o)}else e.$admin.alert("返回数据格式不正确")}).catch(function(){e.adding=!1});this.$refs.topInput.focus()}}},l=(0,t.n)({render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"curd-choose-input"},[e.multiple?i("div",{ref:"inlineTags",staticClass:"curd-choose-multi"},[e.firstSelected?i("el-tag",{attrs:{type:"info","disable-transitions":!0,size:e.autoSize}},[i("i",[e._v(e._s(e.firstSelected))])]):e._e(),e.countSelected?i("el-tag",{staticStyle:{"flex-shrink":"0"},attrs:{type:"info","disable-transitions":!0,size:e.autoSize}},[i("i",[e._v("+"+e._s(e.countSelected))])]):e._e()],1):e._e(),i("el-input",{ref:"inlineInput",attrs:{name:e.name,id:e.id,size:e.autoSize,disabled:e.autoDisabled,placeholder:e.inputPlaceholder,readonly:!e.allowInput},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:(t.preventDefault(),e._addInputMult(t))}},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}},[i("i",{directives:[{name:"show",rawName:"v-show",value:e.showClear,expression:"showClear"}],staticClass:"el-input__icon el-icon-circle-close el-input__clear",attrs:{slot:"suffix"},on:{mousedown:function(e){e.preventDefault()},click:e._clear},slot:"suffix"}),i("el-button",{staticClass:"curd-choose-button",attrs:{slot:"append",icon:e.selectIcon},on:{click:e.choose},slot:"append"})],1),i("el-dialog",{attrs:{top:"10vh","custom-class":"curd-choose-dialog",visible:e.dialogVisible,"append-to-body":!0},on:{"update:visible":function(t){e.dialogVisible=t},closed:e._chooseClosed}},[i("template",{slot:"title"},[i("el-input",{ref:"topInput",staticStyle:{width:"230px",margin:"0 5px 0 4px"},attrs:{size:"small"},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search(t)}},model:{value:e.dialogQ,callback:function(t){e.dialogQ="string"==typeof t?t.trim():t},expression:"dialogQ"}},[i("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix"},on:{click:e.search},slot:"suffix"})]),!e.staticIcon&&e.showPlus?i("el-button",{attrs:{size:"small",icon:"el-icon-plus",type:"primary",loading:e.adding,circle:""},on:{click:e.addNew}}):e._e(),i("el-button",{attrs:{size:"small",icon:"el-icon-refresh",circle:"",plain:""},on:{click:function(t){!e.staticIcon&&e.fresh}}}),e.multiple&&e.multipleLimit?i("span",{staticStyle:{"font-size":"12px","margin-left":"10px",color:"#ccc"}},[e._v("最多选"+e._s(e.multipleLimit)+"个")]):e._e(),e.multiple&&e.selected.length?i("draggable",{staticClass:"curd-choose-selected",attrs:{list:e.selected,animation:340},on:{end:e._sortSelected}},e._l(e.selected,function(t,a){return i("el-tag",{key:t.value,attrs:{closable:""},on:{close:function(t){return e._removeTag(a)}}},[e.staticIcon||2==e.itemType?i("i",{class:"curd-choose-selected-icon "+t.label}):3==e.itemType?i("img",{staticClass:"curd-choose-selected-img",attrs:{src:t.label}}):[e._v(e._s(t.label))]],2)}),1):e._e()],1),i("div",{directives:[{name:"loading",rawName:"v-loading",value:e.dialogLoading,expression:"dialogLoading"}],staticClass:"curd-choose-wrap"},[e.dialogError?i("div",{staticClass:"curd-choose-error"},[e._v(e._s(e.dialogError))]):i("div",{staticClass:"curd-choose-scroll"},[e.dialogLoading||e.options.length?i("div",{staticClass:"curd-choose-items"},[e._l(e.options,function(t){return["/"===t.label?i("div",{key:t.value,staticClass:"curd-choose-break"}):i("div",{key:t.value,staticClass:"curd-choose-item",on:{click:function(i){return e._select(t)}}},[e._t("item",[e.staticIcon||2==e.itemType?i("i",{class:"curd-choose-icon "+t.label}):3==e.itemType?i("img",{staticClass:"curd-choose-img",attrs:{src:t.label}}):i("el-tag",{attrs:{type:"info"}},[e._v(e._s(t.label))])],null,t)],2)]})],2):i("div",{staticClass:"curd-choose-error"},[e._v(" 无数据 ")])])]),e.hasMore?i("el-pagination",{attrs:{slot:"footer",background:"",layout:"pager,jumper","current-page":e.dataPage,"page-size":e.pageSize,total:e.dataTotal},on:{"update:currentPage":function(t){e.dataPage=t},"update:current-page":function(t){e.dataPage=t},"current-change":e.toPage},slot:"footer"}):e._e()],2)],1)},staticRenderFns:[]},function(e){e&&e("data-v-e7dec4ac_0",{source:".curd-choose-input{position:relative;font-size:0}.curd-choose-multi{position:absolute;height:100%;z-index:2;display:flex;align-items:center;box-sizing:border-box;width:100%;padding:0 46% 0 10px;pointer-events:none}.curd-choose-multi .el-tag{margin-right:4px;overflow:hidden;padding-right:0}.curd-choose-multi .el-tag i{display:block;margin-right:10px;overflow:hidden}.curd-choose-button.is-disabled,.curd-choose-button.is-disabled:focus,.curd-choose-button.is-disabled:hover{background:0 0}.curd-choose-dialog{width:50%;min-width:600px}.curd-choose-dialog .el-dialog__header{padding:16px 16px 10px 16px;border-bottom:1px solid #eee;box-shadow:0 2px 2px 0 rgba(0,0,0,.02)}.curd-choose-dialog .el-dialog__headerbtn{top:24px}.curd-choose-selected{width:100%;padding-top:10px}.curd-choose-selected .el-tag{margin:4px;cursor:move}.curd-choose-selected .sortable-chosen{background-color:#fef0f0;border-color:#fde2e2;color:#f56c6c}.curd-choose-selected-icon{font-size:16px;vertical-align:middle}.curd-choose-selected-img{width:22px;height:22px;object-fit:contain;vertical-align:middle}.curd-choose-dialog .el-dialog__body{padding:0}.curd-choose-wrap{position:relative;width:100%;min-height:200px}.curd-choose-error{position:absolute;top:0;left:0;width:100%;height:100%;display:flex;align-items:center;justify-content:center;color:#bbb}.curd-choose-scroll{width:100%;max-height:60vh;overflow-y:auto}.curd-choose-items{padding:10px 16px}.curd-choose-item{display:inline-block;cursor:pointer}.curd-choose-break{border-bottom:1px solid #eee;margin:15px 0}.curd-choose-img{width:100px;height:100px;object-fit:contain;display:block;margin:4px}.curd-choose-item .el-tag{margin:4px}.curd-choose-item .el-tag:hover{background-color:#eaeaea;border-color:#d6d6d6}.curd-choose-icon{margin:4px;font-size:2.25em;padding:8px;color:#999;border-radius:4px;display:inline-block}.curd-choose-icon:hover{color:#000;background:#efefef}.curd-choose-dialog .el-dialog__footer{padding:12px 0;text-align:center;border-top:1px solid #eee}",map:void 0,media:void 0})},n,void 0,!1,void 0,!1,t.c,void 0,void 0);function s(){var e=this;this.$el&&(this._editorArea||(this._editorArea=this.$el.firstElementChild.firstElementChild),this.editor&&this.sync().editor.remove(),require(["kindeditor"],function(t){e.loading=!1;var i=Object.assign({},e.options);if("change"===e.syncType){var a=i.afterChange;i.afterChange=function(){e.sync(),a&&a()}}else if("none"!==e.syncType){var r=i.afterBlur;i.afterBlur=function(){e.sync(),r&&r()}}var o=i.afterFocus;i.afterFocus=function(){document.dispatchEvent(new Event("mousedown")),setTimeout(function(){document.dispatchEvent(new Event("mouseup"))},10),o&&o()},e.editor=t.create(e._editorArea,i)}))}var d={name:"CurdEditor",inject:["curdForm"],props:{value:String,options:Object,syncType:String},model:{prop:"value",event:"change"},watch:{options:{immediate:!0,handler:function(){s.call(this)}}},data:function(){return{loading:!0}},created:function(){"none"===!this.syncType&&this.curdForm&&this.curdForm.beforValidate(this.sync)},mounted:function(){s.call(this)},methods:{sync:function(){return this.$emit("change",this.editor.html()),this},focus:function(){this.editor.focus()},blur:function(){this.editor.blur()},isEmpty:function(){return this.editor.isEmpty()},insertHtml:function(e){this.editor.insertHtml(e)},appendHtml:function(e){this.editor.appendHtml(e)},fullscreen:function(e){this.editor.fullscreen(e)},readonly:function(e){this.editor.readonly(e)},insertHtml:function(e){this.editor.insertHtml(e)},html:function(e){if(void 0===e)return this.editor.html();this.editor.html(e)},text:function(e){if(void 0===e)return this.editor.text();this.editor.text(e)},count:function(e){return this.editor.count(e)},selectedHtml:function(){return this.editor.selectedHtml()},remove:function(){this.editor.remove()}}},c=(0,t.n)({render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"curd-editor"},[t("div",{directives:[{name:"loading",rawName:"v-loading",value:this.loading,expression:"loading"}],staticStyle:{width:"100%"}},[t("textarea",{style:"width:100%;height:400px;padding:0;border:0;visibility:hidden",domProps:{value:this.value}})]),this._t("footer")],2)},staticRenderFns:[]},function(e){e&&e("data-v-11e07584_0",{source:".curd-editor{width:100%}.ke-container{box-sizing:border-box}.ke-container,.ke-toolheader{border-color:#dcdfe6!important}",map:void 0,media:void 0})},d,void 0,!1,void 0,!1,t.c,void 0,void 0),u=[{name:"label",label:"选项名",required:!0,component:"el-input"},{name:"value",label:"选项值",required:!0,component:"el-input",props:{type:'$eval(return $data.value_append ? "number" : "text")'},slots:{suffix:"inputSuffix"}}],p={name:"CurdTreeSet",props:{max:Number,value:{required:!0}},data:function(){return{treeDialogVisible:!1,treeDialogData:{},treeOptions:[]}},computed:{treeDialogConfig:function(){return u}},watch:{value:{immediate:!0,handler:function(){this.__triggerValue?this.__triggerValue=!1:this._passiveChange()}}},methods:{_passiveChange:function(){var e=[];this._insertNode(e,this.value),this.treeOptions=e,this._triggerChange()},_triggerChange:function(){var e=[];this._insertNode(e,this.treeOptions,!0),this.__triggerValue=!0,this.$emit("input",e),this.$emit("change",e)},_insertNode:function(e,t,i){var a=this;(t||[]).forEach(function(t){if("label"in(t=t||{})&&"value"in t){var r=t.label,o=t.value,n=t.children,l={label:r,value:o};(!i||Array.isArray(n)&&n.length)&&(l.children=[],a._insertNode(l.children,n,i)),e.push(l)}})},treeForm:function(e,t){var i,a=this;this.__treeTmpData=[t||0,e];var r="",o="",n=!1;t&&(r=(i=e).label,n="number"==typeof(o=i.value)),this.treeDialogData={label:r,value:o,value_append:n},this.$refs.treeForm?this.$nextTick(function(){a.$refs.treeForm.clearValidate(),a.treeDialogVisible=!0}):this.treeDialogVisible=!0},treeSave:function(){var e=this;this.$refs.treeForm.validate().then(function(){var t=e.__treeTmpData,i=t[0],a=t[1],r=e.treeDialogData,o=r.label,n=r.value;if(n=r.value_append?1*n:n,i)a.label=o,a.value=n;else{var l={value:n,label:o,children:[]};a?(a.children||e.$set(a,"children",[]),a.children.push(l)):e.treeOptions.push(l)}e.treeDialogVisible=!1,e._triggerChange()}).catch(function(){})},treeDelete:function(e,t){var i=e.parent,a=i.data.children||i.data,r=a.findIndex(function(e){return e.value===t.value});a.splice(r,1),this._triggerChange()}}},h=(0,t.n)({render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"curd-tree-set"},[i("el-tree",{attrs:{data:e.treeOptions,"expand-on-click-node":!0,"node-key":"value",draggable:""},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.node,r=t.data;return i("div",{staticClass:"curd-tree-set-node"},[i("div",{staticClass:"el-tree-node__label"},[e._v(e._s(r.label)),i("span",[e._v("("+e._s(r.value)+")")])]),i("span",[!e.max||a.level<=e.max?i("i",{staticClass:"el-icon-folder-add",on:{click:function(t){return t.stopPropagation(),e.treeForm(r)}}}):e._e(),i("i",{staticClass:"el-icon-edit-outline",on:{click:function(t){return t.stopPropagation(),e.treeForm(r,1)}}}),i("el-popconfirm",{attrs:{title:"确定移除该项"+(r.children&&r.children.length?"及其子项":"")+"？"},on:{onConfirm:function(t){return e.treeDelete(a,r)}}},[i("i",{staticClass:"el-icon-delete",attrs:{slot:"reference"},on:{click:function(e){e.stopPropagation()}},slot:"reference"})])],1)])}}])}),i("div",{staticClass:"curd-tree-set-footer"},[i("div",{on:{click:function(t){return e.treeForm(null)}}},[i("el-icon",{attrs:{name:"folder-add"}}),e._v(" 添加顶级项")],1),i("span",[e._v("可拖拽进行排序")])]),i("el-dialog",{attrs:{"custom-class":"curd-tree-set-dialog",visible:e.treeDialogVisible,"append-to-body":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){e.treeDialogVisible=t}}},[i("curd-form",{ref:"treeForm",attrs:{"validate-on-rule-change":!1,fields:e.treeDialogConfig,data:e.treeDialogData,labelWidth:70},scopedSlots:e._u([{key:"inputSuffix",fn:function(){return[i("el-checkbox",{model:{value:e.treeDialogData.value_append,callback:function(t){e.$set(e.treeDialogData,"value_append",t)},expression:"treeDialogData.value_append"}},[e._v("数字")])]},proxy:!0}])}),i("span",{attrs:{slot:"footer"},slot:"footer"},[i("el-button",{on:{click:function(t){e.treeDialogVisible=!1}}},[e._v("取 消")]),i("el-button",{attrs:{type:"primary"},on:{click:e.treeSave}},[e._v("确 定")])],1)],1)],1)},staticRenderFns:[]},function(e){e&&e("data-v-2ef70da1_0",{source:".curd-tree-set{width:100%;box-sizing:border-box;padding:10px;border:1px solid #eff2f9}.curd-tree-set .el-icon-folder-add{color:#43a047}.curd-tree-set-node .el-icon-edit-outline{color:#03a9f4}.curd-tree-set .el-icon-delete{color:#ef5350}.curd-tree-set-node{user-select:none;flex:1;display:flex;padding-right:8px;justify-content:space-between}.el-tree-node__label span{color:#bbb;margin-left:4px}.curd-tree-set-footer{display:flex;align-items:center;box-sizing:border-box;font-size:12px;padding:10px 0 0 9px;color:#c1c1c1}.curd-tree-set-footer div{margin-right:15px;color:#43a047;font-size:14px;cursor:pointer}.curd-tree-set-dialog{width:420px}.curd-tree-set-dialog input[type=number]{-moz-appearance:textfield}.curd-tree-set-dialog input::-webkit-inner-spin-button,.curd-tree-set-dialog input::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}",map:void 0,media:void 0})},p,void 0,!1,void 0,!1,t.c,void 0,void 0);var f={"el-input":["prefix","suffix","prepend","append"],"el-autocomplete":["prefix","suffix","prepend","append"],"el-select":["default","prefix","empty"],"el-cascader":["empty"],"el-date-picker":["range-separator"],"el-upload":["trigger","tip"],"el-transfer":["left-footer","right-footer"]},g={"el-input":{append:["append","appname"],prepend:["prepend","prename"]},"el-autocomplete":{append:["append","appname"],prepend:["prepend","prename"]},"el-radio-group":{default:["options","button"]},"el-checkbox-group":{default:["options","button"]},"el-select":{default:["options"]},"curd-editor":{footer:["footer"]}},m={},v={name:"CurdForm",provide:function(){return{curdForm:this}},props:{size:{type:String,default:""},labelPosition:{type:String,default:"left"},labelWidth:{type:Number,default:150},hideRequiredAsterisk:{type:Boolean,default:!1},inlineMessage:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},validateOnRuleChange:{type:Boolean,default:!0},gutter:{type:Number,required:!1,default:0},fields:{type:Array,required:!0,default:[]},data:{type:Object,required:!0,default:{}},designMode:{type:Boolean,default:!1},forceXspan:Boolean,dragGroup:String,fieldGroup:String,onFieldUpdate:Function,onFieldClick:Function,onFieldDragEnd:Function,onFieldChange:Function},data:function(){return{propsDymDatas:{},fieldsVhidden:{},fieldsDestory:{},validateBefore:[],designFieldIndex:-1,submiting:!1}},computed:{form:function(){var e=this;this.onFieldUpdate&&this.onFieldUpdate();var t=[],i={},a={},r={},o={};return this.fields.forEach(function(n,l){n.resolver&&(n=n.resolver(n));var s=n.required;void 0===s&&(s=!1);var d=n.reqmsg;void 0===d&&(d=null);var c=n.styleWidth,u=n.vshow,p=n.props;void 0===p&&(p={});var h=n.rules;void 0===h&&(h=[]);var m=n.slots;void 0===m&&(m={});var v=function(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&-1===t.indexOf(a)&&(i[a]=e[a]);return i}(n,["required","reqmsg","styleWidth","vshow","props","rules","slots"]),_=v.name;if(v.component){if(!_)return}else if(!v.template)return;var b=Object.assign({},{span:24,events:{}},v);b.props=e._formatFieldProps(n,r,o),b.labelDisable&&(b.label=null),b.label||b.labelWidth||(b.labelWidth="0px"),b.xspan||(b.xspan=b.span),e.forceXspan&&(b.span=b.xspan),b.help&&(b.help=b.help.replace(/\n/g,"<br/>"));var y=null;c&&(p.style?p.style.width?y=p.style:(y=JSON.parse(JSON.stringify(p.style))).width=c:y={width:c}),v.component||y||!p.style||(y=p.style),b.style=y,_&&u&&Array.isArray(u)&&u.length>1&&u[0]&&u[0]!==_&&(a[_]=u),e.onFieldChange&&b.onChange&&("el-autocomplete"===b.component?(b.events.blur=function(){e.onFieldChange(b.onChange,_,e.data[_])},b.events.select=function(t){e.onFieldChange(b.onChange,_,t.value)}):b.events.change=function(t){e.onFieldChange(b.onChange,_,t)});var x="string"==typeof b.component?b.component:null,w={},$={};Object.entries(m).forEach(function(e){var t=e[0],i=e[1];if((i="string"==typeof i?{name:i}:i||{}).name){var a="old"in i?Boolean(i.old):x&&x in f&&f[x].includes(t),r={name:i.name,props:i.props||{}};a?w[t]=r:$[t]=r}});var k={};if(x&&x in g)for(var D in g[x])D in w||D in $||g[x][D].forEach(function(e){e in b.props&&(k[e]=b.props[e])});if("el-input"===x||"el-autocomplete"===x){if(k.append&&Array.isArray(k.append)){var C=e._parseSelectOptions(k.append,!0);C?(k.append=C,k.appWidth=e._selectWidth(C),k.appname||(k.appname=b.name+"_append")):delete k.append}if(k.prepend&&Array.isArray(k.prepend)){var O=e._parseSelectOptions(k.prepend,!0);O?(k.prepend=O,k.preWidth=e._selectWidth(O),k.prename||(k.prename=b.name+"_prepend")):delete k.prepend}}else k.options&&("el-select"===x?k.options=e._parseSelectOptions(k.options,!0):"el-radio-group"!==x&&"el-checkbox-group"!==x||(k.options=e._parseSelectOptions(k.options)));b.extra=k,b.oldSlots=w,b.newSlots=$,t.push(b),e.designMode||(i[_]=s?[{required:!0,message:d||(b.label?b.label:"该项")+"必须设置"}].concat(h):h)}),this.fieldsVhidden={},this._vshowCondition=a,this.propsDymDatas=r,this._propsDymCondition=o,{fields:t,rules:i}}},watch:{form:{immediate:!0,handler:function(){this._bindWatcher()}}},beforeDestroy:function(){this._unbindWatcher()},methods:{_formatFieldProps:function(e,t,i){var a=this,r=e.name,o=e.props||{},n={},l=[],s={hasEval:!1,hasData:!1};this._findFieldPropsDataVar(o,n,l,s,[]);var d=!1;"el-autocomplete"===e.component&&!("fetchSuggestions"in o)&&"suggest"in o&&(d=!0,n.fetchSuggestions=function(e,t){a._autocompleteFetch(o.suggest,e,t)});var c=("el-cascader"===e.component||"el-cascader-panel"===e.component)&&this._getCascaderLazyLoad(o,n,r);return d||c||s.hasEval||s.hasData?(s.hasData&&(t[r]=n),l.length&&(i[r]=l),n):o},_findFieldPropsDataVar:function(e,t,i,a,r){var o,n,l,s;for(o in e)(n=e[o])&&n.constructor===Object?(t[o]={},this._findFieldPropsDataVar(n,t[o],i,a,r.concat([o]))):"string"==typeof n?n.startsWith("$data.")?(t[o]="",a.hasData=!0,i.push([n.substr(6),r.concat([o])])):n.startsWith("$eval(")&&n.endsWith(")")?(s=(l=n.substring(6,n.length-1)).indexOf("$data.")>-1?l.match(/\$data.([a-zA-Z_]+)/g):[]).length?(t[o]="",a.hasData=!0,l=new Function("$data",l),s.forEach(function(e){i.push([e.substr(6),r.concat([o]),l])})):(a.hasEval=!0,t[o]=new Function(l)()):t[o]=n:t[o]=n},_autocompleteFetch:function(e,t,i){if(Array.isArray(e)){var a=[];return e.forEach(function(e){t&&0!==e.toLowerCase().indexOf(t.toLowerCase())||a.push({value:e})}),void i(a)}var r=e||{},o=r.url,n=r.credentials;o?this._fetchGetJson(o+(o.indexOf("?")>-1?"&":"?")+"q="+t,n,[]).then(function(e){var t=[];e.forEach(function(e){t.push({value:e})}),i(t)}):i([])},_getCascaderLazyLoad:function(e,t,i){var a=this,r="props"in e?Object.assign({},e.props):null;if(r&&r.lazy&&r.lazyLoad)return!1;var o="remote"in e?Object.assign({},e.remote):null;if(!o||!o.url)return!1;var n=o.geography,l=o.options;if(n)return this._getCascaderGeography(o.url,l,t,i),!0;var s=Boolean(o.credentials);return o.once?(this._fetchGetJson(o.url,s,[]).then(function(e){t.options=e,a._reCreateField(i)}),!0):(t.options=[],t.props.lazy=!0,t.props.lazyLoad=function(e,t){var i=e.level;void 0===i&&(i=0);var r=e.uid;void 0===r&&(r=0);var n=e.value;void 0===n&&(n="");var l=e.label;void 0===l&&(l="");var d=o.url+(o.url.indexOf("?")>-1?"&":"?")+"level="+i+"&uid="+r+"&value="+encodeURIComponent(n)+"&label="+l;a._fetchGetJson(d,s,[]).then(t)},!0)},_getCascaderGeography:function(e,t,i,a){var r=this,o=!t.includes(1),n=!t.includes(2),l=!t.includes(3);this._fetchGetJson(e,!1,[],!0).then(function(e){var t={},s=[];Object.keys(e).sort().forEach(function(i){var a=Number(i),r=a%1e4,d=0===r,c=d?a:a-r;if(!(o&&81e4===c||n&&82e4===c||l&&71e4===c)){var u={label:e[i],value:a};if(d)return u.children=[],t[i]=u.children,void s.push(u);if(a%100==0)return u.children=[],t[i]=u.children,void t[c].push(u);var p=i-i%100;e[p]?t[p].push(u):t[c].push(u)}}),i.options=s,r._reCreateField(a)})},_reCreateField:function(e){var t=this;if(e in this.fieldsDestory)this.fieldsDestory[e]=!0;else{var i=Object.assign({},this.fieldsDestory);i[e]=!0,this.fieldsDestory=i}this.$nextTick(function(){t.fieldsDestory[e]=!1})},_fetchGetJson:function(e,t,i,a){if(a&&e in m)return Promise.resolve(m[e]);var r={handleError:!1,credentials:t?"cors":"omit"};return this.$admin.fetchJson(e,r).catch(function(){return i}).then(function(t){return a&&(m[e]=t),t})},_unbindWatcher:function(){Array.isArray(this._unWatchQueue)&&this._unWatchQueue.forEach(function(e){e()})},_bindWatcher:function(){var e,t,i=this;this._unbindWatcher(),this._updateFormFields(!0);var a={};for(e in this._vshowCondition)t=this._vshowCondition[e][0],a[t]=1;for(e in this._propsDymCondition)(t=this._propsDymCondition[e]).forEach(function(e){var t=e[0];a[t]=t in a?3:2});for(e in this._unWatchQueue=[],a)!function(e,t){i._unWatchQueue.push(i.$watch("data."+e,function(a){t>2?i._updateFormFields(!1,e):t>1?i._updateFormFieldsProps(e):i._updateFormFieldsVhidden()},{deep:!0}))}(e,a[e])},_updateFormFields:function(e,t){this._updateFormFieldsProps(t),this._updateFormFieldsVhidden(e)},_updateFormFieldsProps:function(e){var t,i=this;for(t in this._propsDymCondition)this._propsDymCondition[t].forEach(function(a){var r=a[0];if(!e||e===r){var o,n=i.propsDymDatas[t],l=a[1],s=l.length,d=l[s-1];if(s>1)for(o=0;o<s-1;o++)n=n[l[o]];var c=a.length>2?a[2]:null;n[d]=c?c(i.data):i.data[r]}})},_updateFormFieldsVhidden:function(e){var t,a,r={};for(t in this._vshowCondition)a=!i.curdVshow(this.data,this._vshowCondition,t),e?r[t]=a:this.fieldsVhidden[t]=a;e&&(this.fieldsVhidden=r)},_parseSelectOptions:function(e,t){var i=this,a=[],r=[];return e.forEach(function(e){if(t&&e.options){var o=i._parseOptions(e.options);o&&r.push({label:e.label,disabled:e.disabled,options:o})}else i._formatOption(a,e)}),t?(a.length&&r.unshift({label:null,options:a}),r):a},_parseOptions:function(e){var t=this;if(!Array.isArray(e))return!1;var i=[];return e.forEach(function(e){t._formatOption(i,e)}),i},_formatOption:function(e,t){var i="label"in t,a="value"in t;(i||a)&&(t=Object.assign({},t),a?i||(t.label=t.value):t.value=t.label,e.push(t))},_selectWidth:function(e){if(!Array.isArray(e))return"";var t,i,a,r,o,n,l=0,s=e.length;for(t=0;t<s;t++)for(i=e[t].options,a=0;a<i.length;a++)o=(r=i[a].label||i[a].value).match(/[\u4e00-\u9fa5]/g),(n=r.length+(o?o.length:0))>l&&(l=n);return l=Math.min(100,7*l)+50,"width:"+(l=Math.max(l,84))+"px"},_fieldColClass:function(e,t){var i=[];return this.designFieldIndex===e&&i.push("curd-maker-active"),this.fieldsVhidden[t]&&i.push("curd-maker-shadow"),i.length?i.join(" "):null},_clickField:function(e,t){this.designFieldIndex=e,this.onFieldClick&&this.onFieldClick(e,t)},beforValidate:function(e){var t=this,i=this.validateBefore.push(e);return function(){t.validateBefore[i-1]=null}},validate:function(e){var t=this,i=[];return this.validateBefore.forEach(function(e){e&&i.push(Promise.resolve(e()))}),Promise.all(i).then(function(){return t.$refs.elForm.validate(e)})},validateField:function(e,t){return this.$refs.elForm.validateField(e,t)},resetFields:function(){return this.$refs.elForm.resetFields()},clearValidate:function(e){return this.$refs.elForm.clearValidate(e)},submitForm:function(){var e=this;this.validate().then(function(t){e.$emit("submit",e.data)}).catch(function(){})},submitLoad:function(){this.submiting=!0},submitDone:function(){this.submiting=!1}}};function _(e,t){var i={};for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&-1===t.indexOf(a)&&(i[a]=e[a]);return i}var b=(0,t.n)({render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-form",{ref:"elForm",class:"curd-elform"+(e.designMode?" curd-elform-design":""),attrs:{size:e.size,disabled:e.disabled,"label-width":e.labelWidth+"px","label-position":e.labelPosition,"hide-required-asterisk":e.hideRequiredAsterisk,"inline-message":e.inlineMessage,"validate-on-rule-change":e.validateOnRuleChange,model:e.data,rules:e.form.rules},nativeOn:{submit:function(e){e.preventDefault()}}},[i("el-row",{attrs:{gutter:e.gutter}},[e._t("header"),i("draggable-if",{staticClass:"curd-elform-draggable",attrs:{animation:340,list:e.fields,enable:e.designMode,group:{name:e.fieldGroup,put:[e.dragGroup]}},on:{end:e.onFieldDragEnd}},e._l(e.form.fields,function(t,a){return i("el-col",{directives:[{name:"show",rawName:"v-show",value:e.designMode||!e.fieldsVhidden[t.name],expression:"designMode || !fieldsVhidden[field.name]"}],key:t.name,class:e.designMode?e._fieldColClass(a,t.name):"",attrs:{span:t.span,xs:{span:t.xspan}},nativeOn:{click:function(t){return e._clickField(a)}}},[i("el-form-item",{attrs:{label:t.label,"label-width":t.labelWidth,prop:t.name},scopedSlots:e._u([t.label&&t.help?{key:"label",fn:function(){return[e._v(" "+e._s(t.label)),i("el-tooltip",{attrs:{transition:"none"}},[i("span",{attrs:{slot:"content"},domProps:{innerHTML:e._s(t.help)},slot:"content"}),i("i",{staticClass:"el-icon-question"})])]},proxy:!0}:null],null,!0)},[t.component&&!e.fieldsDestory[t.name]?i(t.component,e._g(e._b({tag:"component",style:t.style,scopedSlots:e._u([e._l(t.newSlots,function(t,i){return{key:i,fn:function(i){return[e._t(t.name,null,null,i)]}}})],null,!0),model:{value:e.data[t.name],callback:function(i){e.$set(e.data,t.name,i)},expression:"data[field.name]"}},"component",t.props,!1),t.events),[!t.extra.prepend||"el-input"!==t.component&&"el-autocomplete"!==t.component?e._e():i("template",{slot:"prepend"},[Array.isArray(t.extra.prepend)?i("el-select",{staticClass:"curd-input-inner_select",style:t.extra.preWidth,model:{value:e.data[t.extra.prename],callback:function(i){e.$set(e.data,t.extra.prename,i)},expression:"data[field.extra.prename]"}},e._l(t.extra.prepend,function(t,a){var r=t.options,o=_(t,["options"]);return i("el-option-group",e._b({key:"g"+a},"el-option-group",o,!1),e._l(r,function(t){return i("el-option",e._b({key:t.value},"el-option",t,!1))}),1)}),1):i("span",[e._v(e._s(t.extra.prepend))])],1),!t.extra.append||"el-input"!==t.component&&"el-autocomplete"!==t.component?"el-radio-group"!==t.component&&"el-checkbox-group"!==t.component||!t.extra.options?"el-select"===t.component&&t.extra.options?e._l(t.extra.options,function(t,a){var r=t.options,o=_(t,["options"]);return i("el-option-group",e._b({key:"g"+a},"el-option-group",o,!1),e._l(r,function(t){return i("el-option",e._b({key:t.value},"el-option",t,!1))}),1)}):"curd-editor"===t.component&&t.extra.footer?i("div",{staticClass:"curd-editor-footer",attrs:{slot:"footer"},slot:"footer"},e._l(t.extra.footer,function(t,a){return i("el-checkbox",{key:a,model:{value:e.data[a],callback:function(t){e.$set(e.data,a,t)},expression:"data[name]"}},[e._v(e._s(t))])}),1):e._e():e._l(t.extra.options,function(a){var r=a.label,o=a.value,n=_(a,["label","value"]);return i("el-radio-group"===t.component?t.extra.button?"el-radio-button":"el-radio":t.extra.button?"el-checkbox-button":"el-checkbox",e._b({key:o,tag:"component",attrs:{label:o}},"component",n,!1),[e._v(e._s(r))])}):i("template",{slot:"append"},[Array.isArray(t.extra.append)?i("el-select",{staticClass:"curd-input-inner_select",style:t.extra.appWidth,model:{value:e.data[t.extra.appname],callback:function(i){e.$set(e.data,t.extra.appname,i)},expression:"data[field.extra.appname]"}},e._l(t.extra.append,function(t,a){var r=t.options,o=_(t,["options"]);return i("el-option-group",e._b({key:"g"+a},"el-option-group",o,!1),e._l(r,function(t){return i("el-option",e._b({key:t.value},"el-option",t,!1))}),1)}),1):i("span",[e._v(e._s(t.extra.append))])],1),e._l(t.oldSlots,function(t,a){return i("template",{slot:a},[e._t(t.name,null,null,t.props)],2)})],2):e._t(t.template,null,{styles:t.style,props:t.props,events:t.events,data:e.data,field:t.name})],2)],1)}),1),e._t("footer",[e.designMode?e._e():i("el-col",[i("el-form-item",[i("el-button",{attrs:{type:"primary",loading:e.submiting},on:{click:e.submitForm}},[e._v("立即提交")]),i("el-button",{on:{click:e.resetFields}},[e._v("重置")])],1)],1)])],2)],1)},staticRenderFns:[]},function(e){e&&e("data-v-0383a464_0",{source:".curd-elform .el-slider{margin-right:18px}.curd-elform .el-icon-question{color:#bbb}.curd-input-inner_select .el-input__inner{padding-left:10px}.curd-elform .el-slider__marks-text{margin-top:4px}.curd-elform .el-rate{height:30px;display:flex;align-items:center}.curd-elform .el-cascader-panel{float:left}.curd-editor-footer .el-checkbox__label{padding-left:5px}",map:void 0,media:void 0})},v,void 0,!1,void 0,!1,t.c,void 0,void 0),y={name:"curd",data:function(){return{status:0,pageHeader:null,pageHeaderData:null,dialogVisible:!1,dialogTop:"50px",dialogFull:!1,dialogNoHeader:!1,pageName:null,pageError:null,pageCmpt:null,pageProps:null,loading:!0,total:0,currentPage:1,tableData:[],keyword:"",reviseProps:[],reviseOpen:"",selectSome:!1,selectAll:!1,operateProps:[],operateOpen:""}},props:{tableProps:{type:Object,default:{}},tableEvent:{type:Object,default:function(){return{}}},dataSource:{type:String,required:!0},beforeResolve:Function,afterResolve:Function,pagesize:{type:Number,default:20},columns:{type:Array,default:[]},primary:{type:String,default:"id"},advanceSearch:{type:Object,default:function(){return{enable:!1,config:{}}}},revise:{type:Array,default:[]},rowRevise:{type:Array,default:[]},rowReviseWidth:Number,operate:{type:Array,default:[]}},computed:{tableAttrs:function(){var e=Object.assign({},this.tableProps);return"height"in e&&delete e.height,"max-height"in e&&delete e["max-height"],e},tableColumns:function(){var e=this,t=[],i=!1,a=["width","header-align","align","resizable","class-name"];return this.columns.forEach(function(r,o){var n=null,l={};Object.entries(r).forEach(function(e){var t=e[0],o=e[1];if(a.indexOf(t)>-1)l[t]=o;else if("field"===t)l.prop=o,n=o;else if("name"===t)l.label=o;else if("expand"===t&&o)l.type="expand";else if("flex"===t&&!i&&o&&"width"in r)i=!0,l["min-width"]=r.width;else if("sort"===t&&o)l.sortable="custom";else if("filters"===t){var s=o||{};"options"in s&&Array.isArray(s.options)&&(l.filters=s.options,l["column-key"]="field"in s?s.field:r.field,l["filter-multiple"]="multiple"in s&&s.multiple,"placement"in s&&(l["filter-placement"]=s.placement))}}),"min-width"in l&&delete l.width;var s={props:l,slot:null,header:null};n&&("column-"+n in e.$scopedSlots&&(s.slot="column-"+n),"column-"+n+"-header"in e.$scopedSlots&&(s.header="column-"+n+"-header")),t.push(s)}),t},tableOperateHeader:function(){return"operate-header"in this.$scopedSlots?"operate-header":null},tableOperate:function(){return"operate"in this.$scopedSlots?"operate":null},rowReviseSize:function(){if(this.rowReviseWidth)return this.rowReviseWidth;if(!this.rowRevise.length)return 0;var e="";return this.rowRevise.forEach(function(t){e+=t.name}),13*e.length+10*this.rowRevise.length+30},operateDis:function(){return!this.operate.length||this.loading||!this.total||!this.$refs.table.selection.length}},mounted:function(){if(this.dataSource){this._pagePath=this.$route.meta.uri,this._loadStyle=0,this._reloadTime=0,this._lastError=null,this._sortFields={},this._filterFields={},this._lastRowOperateIndex=null,this._afterDialogClose_loadStyle=0,this._operateIndex=0,this.$_resetOperateData(),document.addEventListener("touchstart",this.$_listenTouch);var e=[];this.revise.forEach(function(t){t.ing=!1,e.push(t)}),this.reviseProps=e;var t=[];this.operate.forEach(function(e){e.ing=!1,t.push(e)}),this.operateProps=t,this.$_initPage()}else this.status=1},destroyed:function(){document.removeEventListener("touchstart",this.$_listenTouch)},watch:{$route:"$_onRouterChange"},methods:{refresh:function(){this.$admin.reload()},$_toggleRevise:function(){this.reviseOpen=""===this.reviseOpen?" open":""},toggleChecked:function(){var e=this;this.tableData.forEach(function(t){e.$refs.table.toggleRowSelection(t)})},$_onSelect:function(){var e=this.$refs.table.selection.length;e?e<this.tableData.length?(this.selectSome=!0,this.selectAll=!1):(this.selectSome=!1,this.selectAll=!0):(this.selectSome=!1,this.selectAll=!1)},$_toggleOperate:function(){this.operateOpen=""===this.operateOpen?" open":""},$_listenTouch:function(e){this.$root.phone&&(""===this.reviseOpen||e.target.closest(".curd-revise")||(this.reviseOpen=""),""===this.operateOpen||e.target.closest(".curd-operate")||(this.operateOpen=""))},$_search:function(){this.toPage(1)},$_onRouterChange:function(e){this.dataSource&&e.meta.uri===this._pagePath&&this.$_initPage()},$_resetOperateData:function(){this._operateData={curd:this,table:this.$refs.table,kind:null,primary:this.primary,data:null,dialog:null,operate:null,row:null,id:null,index:null}},$_doRevise:function(e){this.$_resetOperateData(),this._operateData.kind=0,this.$_doOperateConfirm(e)},$_doRowRevise:function(e,t,i){this._lastRowOperateIndex=i,this.$_resetOperateData(),this._operateData.kind=1,this._operateData.row=t.row,this._operateData.id=t.row[this.primary],this._operateData.index=t.$index,this.$_doOperateConfirm(e)},$_doOperate:function(e){var t=this;this.$_resetOperateData(),this._operateData.kind=2;var i=this.$refs.table.selection,a=[];i.forEach(function(e){t.primary in e&&a.push(e[t.primary])}),a.length&&(this._operateData.row=i,this._operateData.id=a,this.$_doOperateConfirm(e))},$_doOperateConfirm:function(e){if(this._operateData.operate=e,"confirm"in e&&e.confirm){var t="string"==typeof e.confirm?e.confirm:"您确定要 "+e.name+" "+(2===this._operateData.kind?"这 "+this._operateData.id.length+" 项":"")+"吗？";this.$admin.confirm(t).then(this.$_doOperateAction)}else this.$_doOperateAction()},$_doOperateAction:function(){var e=this;this._operateData.data=this.tableData;var t=this._operateData.operate,i=t.type;if(i<3&&(this._operateData.dialog=i),1===this._operateData.kind?(this._operateData.row.$s[this._lastRowOperateIndex]=!0,this.updateRow(this._operateData.row)):t.ing=!0,4!==i){if(3===i)return this.$_doAjaxOperate(t,this._operateData.id);var a=[];this.$root.phone||a.push("_dialog="+t.type),this._operateData.id&&!Array.isArray(this._operateData.id)&&a.push("id="+this._operateData.id);var r=this.$route.meta.uri+"/"+t.link;r+=a.length?(r.indexOf("?")>-1?"&":"?")+a.join("&"):"",this.$router.push(r)}else{var o="callback"in t?t.callback:null;o?Promise.resolve(o(this._operateData)).then(function(){e.$_endOprateIng(t)}):(this.$_endOprateIng(t),this.$admin.alert("未设置操作的回调函数"))}},$_doAjaxOperate:function(e,t){var i=this,a={};a[this.primary]=t,this.runAjax(e.link,a).then(function(t){if(i.$_endOprateIng(e),t){var a="after"in e?e.after:0;"function"==typeof a?a(i._operateData,t):1===a?i.toPage(1):2===a&&i.toPage(i.currentPage)}})},runAjax:function(e,t,i){var a=this;return i=i||0,this.$admin.fetchJson(e,{method:"POST",body:t,guard:!1,handleError:!1}).then(function(e){var t="code"in(e=e||{})?e.code:500,r="message"in e?e.message:0===t?"操作成功":"操作失败";return 0!==t?(a.$admin.alert(r,t),!1):(i||a.$message({message:r,type:"success"}),e)}).catch(function(e){return a.$admin.alert("message"in e?e.message:"操作失败","code"in e?e.code:600),!1})},$_dialogFullToggle:function(){this.dialogFull=!this.dialogFull},$_goBack:function(){this.$_backToList(0)},$_handleDialogClosed:function(){this.$_backToList(this._afterDialogClose_loadStyle)},$_backToList:function(e){this._operateIndex++,this.pageError=null,this.pageCmpt=null,this.pageProps=null,this.$route.fullPath!==this._pagePath?(this._loadStyle=e,this.$router.replace(this._pagePath)):(3!==this.status&&(this.status=3),e>1?this.toPage(this.currentPage):e>0&&this.toPage(1))},$_closeOperatePage:function(e,t){var i=null;if(t)i=e;else{var a=this._operateData.operate,r="after"in a?a.after:0;"function"==typeof r?(r(this._operateData),i=0):i=r,0!==e&&1!==e&&2!==e||(i=e)}this._operateData.dialog?(this._afterDialogClose_loadStyle=i,this.dialogVisible=!1):this.$_backToList(i)},$_initPage:function(){var e=this;if(2===this.$admin.loadType()&&(this._loadStyle=2,this._lastError=null),this._lastError)this.$admin.error(this._lastError.code,this._lastError.message);else{var t=this.$route,i=t.path,a=t.query;if(i===this._pagePath)return this.status=3,this._reloadTime&&2!==this._loadStyle?1===this._loadStyle&&this.toPage(1):this.toPage(this.currentPage),void(this._loadStyle=0);var r=null;if(this._operateData.operate)r=this._operateData.operate;else{var o=i.split("/").pop();this.reviseProps.some(function(t){if(t.link===o)return e._operateData.kind=0,r=t,!0}),!r&&"id"in a&&a.id&&this.rowRevise.some(function(t){if(t.link===o)return e._operateData.kind=1,e._operateData.id=a.id,r=t,!0}),this._operateData.operate=r}if(!r||r.type>2)return this.$_endOprateIng(r),void this.$admin.error(404);this.$_loadPage(r)}},$_loadPage:function(e){var t=this,i=this.$root.phone?0:"type"in e?e.type:0;if(i>0){if(!this._reloadTime)return this.$_endOprateIng(e),void this.$router.replace(this._pagePath);this.dialogNoHeader=i>1,this.dialogVisible=!0}"string"==typeof e.path?this.$admin.loadComponent(e.path).then(function(a){t.$_toOperate(e,i,a)}):this.$_toOperate(e,i,e.path)},$_toOperate:function(e,t,i){var a=this,r=a._operateIndex,o={init:function(){r===a._operateIndex&&(a.pageError=!1)},error:function(e){r===a._operateIndex&&(a.pageError=e||"未知错误")},back:function(){r===a._operateIndex&&a.$_closeOperatePage(0,!0)},over:function(e){r===a._operateIndex&&a.$_closeOperatePage(e,!1)},isFull:function(){return a.dialogFull},full:function(e){a.dialogFull=Boolean(e)}};if(this._operateData.dialog=t,this._afterDialogClose_loadStyle=0,this.pageName="name"in e?e.name:"操作",this.pageCmpt=this.$_injectComponent(i),this.pageProps={bag:this._operateData,page:o},t>0)this.dialogFull=!1;else{var n="header"in e?e.header:null;n&&n in this.$scopedSlots&&(this.pageHeader=n,this.pageHeaderData="headerData"in e?e.headerData:void 0),this.status=2}this.$_endOprateIng(e)},$_injectComponent:function(e){var t=e,i="mixins"in t?t.mixins:[],a=!1;return i.some(function(e){if("name"in e&&"__Operate__"===e.name)return a=!0,!0}),a||(i.push({name:"__Operate__",props:["bag","page"]}),t.mixins=i),t},$_endOprateIng:function(e){1===this._operateData.kind?null!==this._lastRowOperateIndex&&this._operateData.row&&"$s"in this._operateData.row&&(this._operateData.row.$s[this._lastRowOperateIndex]=!1,this.updateRow(this._operateData.row)):"ing"in(e=e||{})&&e.ing&&(e.ing=!1)},$_sortClass:function(e){var t="header-cell-class-name"in this.tableProps?this.tableProps["header-cell-class-name"](e):null,i=e.column;if(i.sortable&&i.property in this._sortFields){var a=this._sortFields[i.property]?"descsort":"ascsort";return t?a+" "+t:a}},$_sortList:function(e){var t=e.prop,i=t in this._sortFields?this._sortFields[t]:null;null===i?this._sortFields[t]=!1:!1===i?this._sortFields[t]=!0:delete this._sortFields[t],this.toPage(1)},$_filterList:function(e){var t=this,i=!1;Object.entries(e).forEach(function(e){var a=e[0],r=e[1];r=r.slice(),a in t._filterFields?t._filterFields[a].join("")!==r.join("")&&(i=!0,t._filterFields[a]=r):r.length&&(i=!0,t._filterFields[a]=r)}),i&&this.toPage(1)},toPage:function(e){var t=this,i=Date.now();this._reloadTime=i,this._lastError=null,this.loading=!0,this.selectSome=!1,this.selectAll=!1;var a={};Object.entries(this._filterFields).forEach(function(e){var t=e[0],i=e[1],r=i.length;r&&(a[t]=r>1?i:i[0])});var r={keyword:this.keyword,advance:{},sorts:this._sortFields,filters:a,first:null,last:null,current:this.currentPage,page:e,offset:this.pagesize};this.currentPage=e;var o=this.tableData.length;o&&(this.primary in this.tableData[0]&&(r.first=this.tableData[0][this.primary]),this.primary in this.tableData[o-1]&&(r.last=this.tableData[o-1][this.primary])),this.$admin.fetchJson(this.dataSource,{method:"POST",body:r,handleError:!1}).then(function(e){t._reloadTime===i&&(t.total=e.total,t.tableData=t.resolveData(e.lists),t.loading=!1)}).catch(function(e){t._lastError=e,t.$admin.error(e.code,e.message)})},resolveData:function(e){this.beforeResolve&&(e=this.beforeResolve(e));var t=this.$_resolveDataDisableBtn(e);return this.afterResolve?this.afterResolve(t):t},$_resolveDataDisableBtn:function(e){var t=this;if(this._dataResolver)return e.map(this._dataResolver);var i=[];this.rowRevise.forEach(function(e){i.push("disable"in e&&e.disable&&Array.isArray(e.disable)&&e.disable.length>1?e.disable:null)});var a=!("tree-props"in this.tableProps)||"lazy"in this.tableProps&&this.tableProps.lazy?null:this.tableProps["tree-props"],r=a&&"children"in a?a.children:null,o=function(e){var a=[];return i.forEach(function(i){a.push(!!i&&t.$_compared(e[i[0]],i[1],i[2]))}),e.$s=a,e.$s_=0,r&&r in e&&Array.isArray(e[r])&&(e[r]=e[r].map(o)),e};return this._dataResolver=o,e.map(o)},$_compared:function(e,t,a){return i.curdCompared(e,t,a)},updateRow:function(e){"$s_"in e&&(e.$s_=e.$s_>0?0:1)},view:function(e){if("path"in e){var t={},i=null,a=null,r=null;for(var o in e)"index"===o?i=e[o]:"row"===o?a=e[o]:"id"===o?r=e[o]:t[o]=e[o];this.$_resetOperateData(),this._operateData.kind=4,this._operateData.data=this.tableData,this._operateData.operate=t,this._operateData.index=i,this._operateData.row=a,this._operateData.id=r,a&&"object"==typeof a&&this.primary in a&&(this._operateData.id=a[this.primary]),this.$_loadPage(t)}else this.$admin.alert("未指定组件")}}},x=(0,t.n)({render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"curd-wrp"},[1===e.status?i("div",{staticClass:"curd-center"},[e._v(" 未指定 CURD 组件的数据源 ")]):2===e.status?[i("el-page-header",{attrs:{content:e.pageName},on:{back:e.$_goBack},scopedSlots:e._u([e.pageHeader?{key:"content",fn:function(){return[e._t(e.pageHeader,null,null,e.pageHeaderData)]},proxy:!0}:null],null,!0)}),i("div",{staticClass:"curd-page-component"},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:!0,expression:"true"},{name:"show",rawName:"v-show",value:null===e.pageError,expression:"pageError===null"}],staticClass:"curd-page-loading"}),e.pageError?i("div",{staticClass:"curd-page-loading curd-dialog-error"},[e._v(e._s(e.pageError))]):i(e.pageCmpt,e._b({directives:[{name:"show",rawName:"v-show",value:null!==e.pageError,expression:"pageError!==null"}],tag:"component"},"component",e.pageProps,!1))],1)]:[i("div",{staticClass:"curd-body"},[i("div",{staticClass:"curd-header"},[i("div",{staticClass:"curd-search"},[i("el-input",{attrs:{size:"mini"},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},[i("el-button",{attrs:{slot:"append",type:"primary",size:"mini",icon:"el-icon-search"},on:{click:e.$_search},slot:"append"})],1),e.advanceSearch.enable?i("el-link",{attrs:{type:"primary"}},[e._v("高级")]):e._e()],1),e.reviseProps.length?i("div",{staticClass:"curd-revise"},[i("el-button",{staticClass:"curd-revise-toggle",attrs:{size:"mini",icon:"el-icon-s-operation",disabled:e.loading},on:{click:e.$_toggleRevise}}),i("div",{class:"curd-revise-list"+e.reviseOpen},[e._l(e.reviseProps,function(t,a){return i("el-button",{key:a,attrs:{type:"primary",size:"mini",disabled:e.loading,loading:t.ing},on:{click:function(i){return e.$_doRevise(t)}}},[e._v(e._s(t.name))])}),i("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-refresh",disabled:e.loading},on:{click:e.refresh}})],2)],1):i("div",{staticClass:"curd-revise"},[i("el-button",{attrs:{type:"primary",size:"mini",icon:"el-icon-refresh",disabled:e.loading},on:{click:e.refresh}})],1)]),i("div",{class:"curd-list"+(e.loading||!e.total?" curd-list-none":"")},[i("el-table",e._g(e._b({directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],ref:"table",attrs:{data:e.tableData,"header-cell-class-name":e.$_sortClass},on:{select:e.$_onSelect,"select-all":e.$_onSelect,"sort-change":e.$_sortList,"filter-change":e.$_filterList}},"el-table",e.tableAttrs,!1),e.tableEvent),[e.operate.length?i("el-table-column",{attrs:{type:"selection",width:"34"}}):e._e(),e._l(e.tableColumns,function(t,a){return i("el-table-column",e._b({key:a,scopedSlots:e._u([t.header?{key:"header",fn:function(i){return[e._t(t.header,null,null,i)]}}:null,t.slot?{key:"default",fn:function(i){return[e._t(t.slot,null,{column:t.props.prop},i)]}}:null],null,!0)},"el-table-column",t.props,!1))}),e.tableOperate?i("el-table-column",{attrs:{label:"操作",width:e.rowReviseSize},scopedSlots:e._u([e.tableOperateHeader?{key:"header",fn:function(t){return[e._t(e.tableOperateHeader,null,null,t)]}}:null,{key:"default",fn:function(t){return[e._t(e.tableOperate,null,null,t)]}}],null,!0)}):e.rowRevise.length?i("el-table-column",{attrs:{label:"操作",width:e.rowReviseSize},scopedSlots:e._u([e.tableOperateHeader?{key:"header",fn:function(t){return[e._t(e.tableOperateHeader,null,null,t)]}}:null,{key:"default",fn:function(t){return[i("span",{attrs:{ss:t.row.$s_||0}},[e._l(e.rowRevise,function(a,r){return["$s"in t.row&&"hide"!==t.row.$s[r]?i("el-button",{key:r,style:!t.row.$s[r]&&"color"in a?"color:"+a.color:"",attrs:{type:"text",size:"small",disabled:t.row.$s[r]},nativeOn:{click:function(i){return i.preventDefault(),e.$_doRowRevise(a,t,r)}}},[e._v(e._s(a.name))]):e._e()]})],2)]}}],null,!0)}):e._e()],2)],1)]),i("div",{class:"curd-pager"+(e.operateProps.length?" curd-pager-multi":"")},[e.operateProps.length?i("div",{staticClass:"curd-operate"},[i("el-button",{staticClass:"curd-operate-toggle",attrs:{size:"mini",icon:"el-icon-finished",disabled:e.loading||!e.total},on:{click:e.$_toggleOperate}}),i("el-checkbox",{attrs:{indeterminate:e.selectSome,disabled:e.loading||!e.total},on:{change:e.toggleChecked},model:{value:e.selectAll,callback:function(t){e.selectAll=t},expression:"selectAll"}}),i("div",{class:"curd-operate-list"+e.operateOpen},e._l(e.operateProps,function(t,a){return i("el-button",{key:a,attrs:{type:"text",disabled:t.ing||e.operateDis},on:{click:function(i){return e.$_doOperate(t)}}},[e._v(e._s(t.name))])}),1)],1):e._e(),i("el-pagination",{attrs:{background:"","page-size":e.pagesize,total:e.total,"pager-count":5,"current-page":e.currentPage,layout:"prev, pager, next, jumper"},on:{"current-change":e.toPage}})],1),i("el-dialog",{attrs:{"custom-class":"curd-dialog"+(e.dialogNoHeader?" curd-dialog-noheader":""),"append-to-body":!0,"close-on-click-modal":!1,visible:e.dialogVisible,top:e.dialogTop,fullscreen:e.dialogFull},on:{"update:visible":function(t){e.dialogVisible=t},closed:e.$_handleDialogClosed}},[e._t("default",[i("span",[e._v(e._s(e.pageName))]),i("button",{staticClass:"el-dialog__headerbtn curd-dialog-fullbtn",attrs:{type:"button","aria-label":"FullscreenToggle"},on:{click:e.$_dialogFullToggle}},[i("i",{class:"el-dialog__close el-icon el-icon-"+(e.dialogFull?"bottom-left":"top-right")})])],{slot:"title"}),i("div",{directives:[{name:"loading",rawName:"v-loading",value:!0,expression:"true"},{name:"show",rawName:"v-show",value:null===e.pageError,expression:"pageError===null"}],staticClass:"curd-page-loading"}),e.pageError?i("div",{staticClass:"curd-page-loading curd-dialog-error"},[e._v(e._s(e.pageError))]):i(e.pageCmpt,e._b({directives:[{name:"show",rawName:"v-show",value:null!==e.pageError,expression:"pageError!==null"}],tag:"component"},"component",e.pageProps,!1))],2)]],2)},staticRenderFns:[]},function(e){e&&e("data-v-5f580ea8_0",{source:".curd-wrp{width:100%;height:100%;overflow:hidden;display:flex;flex-direction:column}.curd-center{align-items:center;justify-content:center;color:#999}.curd-body{width:100%;flex:1;overflow:hidden;display:flex;flex-direction:column}.curd-header{width:100%;box-sizing:border-box;padding:0 15px;height:40px;display:flex;justify-content:space-between;align-items:center;background:#fbfbfb;border-bottom:1px solid #f1f1f1}.curd-search{display:flex;align-items:center}.curd-search .el-input{width:280px}.curd-search a{margin-left:8px;font-size:13px}.curd-search input{padding:0 5px;border-right:0}.curd-search .el-input-group__append{color:#2f95ff;background-color:#e5f2ff;border:1px solid #8fc6ff;border-left:1px solid #b8dbff;padding:0}.curd-search .el-input-group__append button{margin:0;border-radius:0}.curd-search .el-input-group__append button:focus,.curd-search .el-input-group__append button:hover{background:#d4e9ff}.curd-search .el-input-group__append button:active{background:#c7e2ff}.curd-revise-toggle{display:none}.curd-list{width:100%;flex:1;overflow:hidden}.curd-list-none .el-table{overflow:hidden!important}.curd-list-none .el-table__empty-block{width:100%!important}.curd-list .el-table{width:100%;height:100%;display:flex;flex-direction:column}.curd-list .el-table::before{display:none}.curd-list .el-table th,.curd-list .el-table--medium th{padding:5px 0}.curd-list .el-table td,.curd-list .el-table--medium td{padding:8px 0}.curd-list .el-table--small th{padding:3px 0}.curd-list .el-table--small td{padding:6px 0}.curd-list .el-table--mini th{padding:2px 0}.curd-list .el-table--mini td{padding:4px 0}.curd-list .el-table .cell{padding-right:0;white-space:nowrap}.curd-list .el-table .el-table__header-wrapper{z-index:2;box-shadow:0 1px 2px 0 rgba(0,0,0,.03)}.curd-list .el-table .ascending .sort-caret.ascending{border-bottom-color:#c0c4cc}.curd-list .el-table .descending .sort-caret.descending{border-top-color:#c0c4cc}.curd-list .el-table .ascsort .sort-caret.ascending{border-bottom-color:#409eff}.curd-list .el-table .descsort .sort-caret.descending{border-top-color:#409eff}.curd-list .el-table .is-scrolling-none{flex:1;overflow-y:auto}.curd-list .el-table--scrollable-x{overflow:auto}.curd-list .el-table--scrollable-x .el-table__header-wrapper{overflow:visible;box-shadow:none}.curd-list .el-table--scrollable-x .el-table__body-wrapper,.curd-list .el-table--scrollable-x .el-table__footer-wrapper{overflow:visible}.curd-pager{z-index:2;width:100%;box-sizing:border-box;padding:8px 0;text-align:center;background:#f6f6f6;box-shadow:0 -1px 1px rgba(0,0,0,.1)}.curd-pager-multi{display:flex;align-items:center;justify-content:space-between;padding:3px 20px 4px 12px}.curd-operate{display:flex;align-items:center}.curd-operate-toggle{display:none}.curd-operate .el-checkbox{margin-right:15px}.curd-page-loading{width:100%;height:20vh}.curd-dialog .curd-page-loading{margin-bottom:36px}.curd-dialog-error{display:flex;align-items:center;justify-content:center;color:#bbb}.curd-wrp .el-page-header{width:100%;box-sizing:border-box;padding:7px 20px;border-bottom:1px solid #f9f9f9}.curd-wrp .el-page-header__left{align-items:center}.curd-wrp .el-page-header__content{flex:1}.curd-page-component{flex:1;overflow-y:auto}.curd-dialog .el-dialog__header{display:flex;align-items:center;height:42px;padding:0;border-radius:4px 4px 0 0;background:#f8f8f8;border-bottom:1px solid #ececec}.curd-dialog .el-dialog__headerbtn{top:13px}.curd-dialog .el-dialog__header span{font-size:18px;color:#303133;margin-left:16px}.curd-dialog-fullbtn{right:50px}.curd-dialog .el-dialog__body{padding:0}.curd-dialog-noheader .el-dialog__header{display:none}.curd-dialog.is-fullscreen{overflow:hidden;display:flex;flex-direction:column}.curd-dialog.is-fullscreen .el-dialog__body{flex:1;overflow:auto}.app-phone .curd-wrp{display:block;height:auto}.app-phone .curd-search .el-input{width:160px}.app-phone .curd-revise{position:relative;z-index:3}.app-phone .curd-revise-toggle{display:block;padding:7px 10px}.app-phone .curd-revise-list{position:absolute;border:1px solid #bfbfbf;right:0;top:32px;background:#fff;min-width:90px;border-radius:4px;display:none}.app-phone .curd-revise-list.open{display:block}.app-phone .curd-revise-list button{width:100%;margin:0;color:#409eff;background:0 0;border-color:transparent;font-size:14px;padding:12px 20px}.app-phone .curd-list .el-table::-webkit-scrollbar{display:none}.app-phone .curd-operate{position:relative;z-index:2}.app-phone .curd-operate .el-checkbox{display:none}.app-phone .curd-operate-toggle{padding:7px 10px;display:block}.app-phone .curd-operate-list{position:absolute;border:1px solid #bfbfbf;left:0;bottom:32px;background:#fff;min-width:90px;border-radius:4px;display:none}.app-phone .curd-operate-list.open{display:block}.app-phone .curd-operate-list button{margin:0;width:100%}.app-phone .curd-pager-multi{padding-left:8px;padding-right:8px}.app-phone .curd-pager .btn-next,.app-phone .curd-pager .btn-prev,.app-phone .el-pagination__jump{display:none!important}.app-phone .el-pagination.is-background .el-pager li{margin:0 3px}",map:void 0,media:void 0})},y,void 0,!1,void 0,!1,t.c,void 0,void 0);return{DraggableIf:o,CurdChoose:l,CurdEditor:c,CurdTreeSet:h,CurdForm:b,Curd:x,install:function(e,t){[o,l,c,h,b,x].forEach(function(t){e.component(t.name,t)}),e.component("draggable",function(e){require(["vuedraggable"],e)})}}});